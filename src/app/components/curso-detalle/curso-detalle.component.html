<div class="container-fluid">
  <div class="row">
    <!-- Sidebar con Currículo -->
    <nav class="col-md-3 col-lg-2 curriculum-sidebar">
      <div class="position-sticky pt-3">
        <h6 class="px-3">Contenido del Curso</h6>
        <div class="accordion" id="curriculumAccordion">
          @for (seccion of secciones; track seccion.idSeccion; let i = $index) {
            <div class="accordion-item">
              <h2 class="accordion-header" [id]="'heading' + seccion.idSeccion">
                <button 
                  class="accordion-button" 
                  type="button" 
                  [class.collapsed]="!isSectionExpanded(seccion.idSeccion)"
                  (click)="toggleSection(seccion.idSeccion)">
                  {{ seccion.nombreSeccion }}
                </button>
              </h2>
              <div 
                [id]="'collapse' + seccion.idSeccion" 
                class="accordion-collapse" 
                [class.collapse]="!isSectionExpanded(seccion.idSeccion)"
                [class.show]="isSectionExpanded(seccion.idSeccion)">
                <div class="accordion-body">
                  @for (leccion of leccionesPorSeccion[seccion.idSeccion]; track leccion.idLeccion) {
                    <div 
                      class="lesson-item mb-2" 
                      [class.active]="currentLesson?.idLeccion === leccion.idLeccion">
                      
                      <div 
                        class="lesson-title lesson-link" 
                        (click)="seleccionarLeccion(leccion, seccion)">
                        {{ leccion.nombreLeccion }}
                      </div>
                      
                      <button 
                        class="btn btn-sm btn-outline-primary resources-btn" 
                        type="button"
                        (click)="toggleResources(leccion.idLeccion)">
                        Recursos
                      </button>
                      
                      @if (areResourcesExpanded(leccion.idLeccion)) {
                        <div class="mt-2">
                          <ul class="list-unstyled ms-3">
                            @if (leccion.material1) {
                              <li>
                                <a 
                                  [href]="leccion.material1" 
                                  class="text-decoration-none resource-link"
                                  target="_blank">
                                  Material 1
                                </a>
                              </li>
                            }
                            @if (leccion.material2) {
                              <li>
                                <a 
                                  [href]="leccion.material2" 
                                  class="text-decoration-none resource-link"
                                  target="_blank">
                                  Material 2
                                </a>
                              </li>
                            }
                          </ul>
                        </div>
                      }
                    </div>
                  }
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">

      <div class="row mb-3">
        <div class="col-12 text-end">
          <button class="btn btn-primary" (click)="regresarCursos()">
            Regresar a Cursos
          </button>
        </div>
      </div>
      <!-- Progreso del Curso -->
      @if (curso) {
        <div class="progress-section mb-4">
          <h4>Tu Progreso</h4>
          <div class="progress mb-2">
            <div 
              class="progress-bar" 
              role="progressbar" 
              [style.width]="getProgressPercentage() + '%'"
              [attr.aria-valuenow]="getProgressPercentage()" 
              aria-valuemin="0" 
              aria-valuemax="100">
              {{ getProgressPercentage().toFixed(2) }}% Completado
            </div>
          </div>
          <small>{{ getProgressText() }}</small>
        </div>
      }

      <!-- Video de la Lección -->
<!-- Video de la Lección -->
        @if (currentLesson) {
        <div class="lesson-video mb-4">
            <h5>{{ currentLesson.nombreLeccion }}</h5>
            
            <div class="video-container">
            <video 
                controls
                class="w-100"
                style="max-height: 400px; background-color: #000;"
                src="/img/curso/VIDEO_EJEMPLO.mp4" >
                
                Tu navegador no soporta video.
            </video>
            </div>

            <div class="video-controls mt-2">
            <button class="btn btn-sm btn-outline-success" (click)="marcarComoCompletada()">
                <i class="fas fa-check me-1"></i>Marcar como completada
            </button>
            </div>
        </div>
        }

      <!-- Barra de Navegación con Tabs -->
      <ul class="nav nav-tabs mb-4" id="lessonTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab">Descripción General</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" data-bs-toggle="tab" data-bs-target="#qa" type="button" role="tab">Preguntas y Respuestas</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" data-bs-toggle="tab" data-bs-target="#notes" type="button" role="tab">Notas</button>
        </li>
      </ul>

      <!-- Contenido de los Tabs -->
      <div class="tab-content" id="lessonTabsContent">
        <div class="tab-pane fade show active" id="general" role="tabpanel">
          <div class="lesson-description">
            <h6>Descripción del Curso</h6>
            @if (curso) {
              <p>{{ curso.descripcion }}</p>
            }
            
            <h6 class="mt-3">Información de la Lección</h6>
            @if (currentLesson) {
              <p>
                Duración: {{ currentLesson.duracion }} minutos
              </p>
            }
          </div>
        </div>
        
        <div class="tab-pane fade" id="qa" role="tabpanel">
          <div class="qa-section">
            <h6>Preguntas y Respuestas</h6>
            <p>Aquí puedes hacer preguntas sobre la lección o ver respuestas de otros estudiantes.</p>
            <textarea class="form-control mb-2" rows="3" placeholder="Haz una pregunta..."></textarea>
            <button class="btn btn-primary">Enviar Pregunta</button>
          </div>
        </div>
        
        <div class="tab-pane fade" id="notes" role="tabpanel">
          <div class="student-notes">
            <h6>Tus Notas</h6>
            <textarea class="form-control" rows="4" placeholder="Escribe tus notas aquí..."></textarea>
            <button class="btn btn-outline-primary mt-2">Guardar Notas</button>
          </div>
        </div>
      </div>

      <!-- Controles de Navegación -->
      <div class="lesson-controls d-flex justify-content-between mt-4">
        <button class="btn btn-secondary" (click)="anteriorLeccion()">Anterior</button>
        <button class="btn btn-primary" (click)="siguienteLeccion()">Siguiente Lección</button>
      </div>
    </main>
  </div>
</div>